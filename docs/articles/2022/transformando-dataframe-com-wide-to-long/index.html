<!DOCTYPE html>
<html lang="pt">
<head>
      <meta charset="UTF-8">
    <meta name="generator" content="Pelican" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giliard Godoi - Transformando pandas dataframes com wide_to_long</title>
      <meta name="description" content="Pesquisador. Aluno de Doutorado. Processamento de Língua Natural. Ingeligência Artificial.
Aprendizado de Máquina. Análise e Visualização de Dados.
Programador Python.
" />
      <link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180">
      <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
      <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
      <!-- <link rel="manifest" href="/manifest.json"> -->
      <meta name="theme-color" content="#333333">
    <link rel="stylesheet" href="https://giliardgodoi.github.io/theme/css/fontawesome.min.css">
    <link rel="stylesheet" href="https://giliardgodoi.github.io/theme/css/bootstrap/bootstrap.min.css" >
    <link rel="stylesheet" href="https://giliardgodoi.github.io/theme/css/theme.css">
    <!-- Code highlight color scheme -->
      <link href="https://giliardgodoi.github.io/theme/css/code_blocks/monokai.css" rel="stylesheet">




    <meta name="tags" content="python" />
    <meta name="tags" content="pandas" />
    <meta name="tags" content="reshaping" />

</head>
<body class="d-flex flex-column min-vh-100">
    <nav class="navbar navbar-expand-sm fixed-top navbar-dark bg-dark">
      <div class="container-fluid ">

        <a href="https://giliardgodoi.github.io/" class="navbar-brand">
            <img src="/images/logo.png" alt="Giliard Godoi" style="width: 30px;">
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsibleNavbar">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-end pe-3" id="collapsibleNavbar">
          <ul class="navbar-nav">
            <li class="nav-item"> <a href="https://giliardgodoi.github.io/pages/sobre/" class="nav-link">Sobre</a></li>
            <li class="nav-item"> <a href="https://giliardgodoi.github.io/pages/contato/" class="nav-link">Contato</a></li>
            <li class="nav-item"> <a href="https://giliardgodoi.github.io/pages/publicacoes/" class="nav-link">Publicações</a></li>
          </ul>
        </div>
      </div>
    </nav>
<div class="my-5">
    <div class="p-5 text-center bg-orange">
        <div class="container py-5">
            <h1 class="text-body-emphasis"> Giliard Godoi </h1>
            <p class="col-lg-8 mx-auto lead">
                Pesquisador. Aluno de Doutorado. Processamento de Língua Natural. Ingeligência Artificial.
Aprendizado de Máquina. Análise e Visualização de Dados.
Programador Python.

            </p>
            <ul class="list-inline">
                  <li class="list-inline-item ms-2">
                    <a class="fab fa-twitter text-decoration-none text-black-50" href="https://twitter.com/giliardgodoi" target="_blank" width="24" height="24"></a>
                  </li>
                  <li class="list-inline-item ms-2">
                    <a class="fab fa-github text-decoration-none text-black-50" href="https://github.com/GiliardGodoi" target="_blank" width="24" height="24"></a>
                  </li>
                  <li class="list-inline-item ms-2">
                    <a class="fab fa-linkedin-in text-decoration-none text-black-50" href="https://www.linkedin.com/in/giliardgodoi/" target="_blank" width="24" height="24"></a>
                  </li>
                  <li class="list-inline-item ms-2">
                    <a class="fab fa-youtube text-decoration-none text-black-50" href="https://www.youtube.com/user/GiliardGodoi" target="_blank" width="24" height="24"></a>
                  </li>
              </ul>
        </div>
    </div>
</div>    <main class="container flex-grow-1">
<div class="container">
  <article>
    <header class="">
      <h1>Transformando pandas dataframes com&nbsp;wide_to_long</h1>
      <!--        -->
      <span class="lead"><p>Quando os nomes das colunas guardam informações que podem ser&nbsp;importantes</p></span>
      <div class="small">  <!-- bg-body-light p-3 rounded -->
        <span class="fst-italic">
          Por
          <a class="link-secondary link-offset-3-hover link-underline link-underline-opacity-0 link-underline-opacity-75-hover" href="https://giliardgodoi.github.io/author/giliard-godoi.html">
            Giliard Godoi
          </a>
          Publicado em <time datetime="2022-07-26T00:00:00-03:00">ter 26 julho 2022.</time>
        </span> <br>
        <span class="fst-italic">
          Categoria:
          <a class="link-secondary link-offset-3-hover link-underline link-underline-opacity-0 link-underline-opacity-75-hover" href="https://giliardgodoi.github.io/category/data-analysis">
            data-analysis
          </a>
 Tags:
          <a class="link-secondary link-offset-3-hover link-underline link-underline-opacity-0 link-underline-opacity-75-hover" href="https://giliardgodoi.github.io/tag/python">
            #python
          </a>
          <a class="link-secondary link-offset-3-hover link-underline link-underline-opacity-0 link-underline-opacity-75-hover" href="https://giliardgodoi.github.io/tag/pandas">
            #pandas
          </a>
          <a class="link-secondary link-offset-3-hover link-underline link-underline-opacity-0 link-underline-opacity-75-hover" href="https://giliardgodoi.github.io/tag/reshaping">
            #reshaping
          </a>
        </span>
      </div>
    </header>
    <section class="mt-5">
      <h2><span class="caps">TL</span>;<span class="caps">DR</span></h2>
<ul>
<li>Formato wide table</li>
<li>Formato long table</li>
<li>Para que serve a função <code>pd.wide_to_long</code></li>
<li>Parâmetros da função</li>
<li>Exemplos</li>
<li>Outros métodos e funções relacionados.</li>
</ul>
<p>Documentação: <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.wide_to_long.html"><code>pd.wide_to_long</code></a></p>
<p>Exemplos mencionados no artigo também estão disponíveis no Google Collab.</p>
<h2>Introdução</h2>
<p>Este artigo discute a utilização da função <code>pd.wide_to_long</code> da biblioteca <a href="https://pandas.pydata.org/">Pandas</a>.
“Wide tables” e “long tables” referem-se a como os dados estão organizados nas tabelas. Não sei se existe uma tradução melhor, mas eu vou adotar os conceitos de tabela no formato amplo (wide) e tabela no formato longo (long).</p>
<h2>Formato wide table (Formato amplo?)</h2>
<p>A organização da tabela no formato amplo é, possivelmente, o que mais naturalmente vem a mente quando pensamos em tabelas.</p>
<p>Esse formato possui as seguintes características:</p>
<ul>
<li>Cada linha corresponde a uma observação de um fenômeno (dados de uma pessoa, de uma transação bancária, etc.)</li>
<li>Cada coluna guarda o valor de um respectivo atributo dessa observação. Por exemplo, no caso de uma pessoa, poderíamos ter uma coluna para a altura, outra para o peso, outra para a data de nascimento.</li>
</ul>
<h2>Formato long table</h2>
<p>Já no formato longo os atributos de uma observação (isto é, o que seria as colunas) estão organizados como registros de uma tabela, isto é, distribuídos pelas linhas da tabela.
Um exemplo básico seria esse:</p>
<p><img alt="Imagem com exemplo de tabelas no formato longo e amplo" class="mx-auto d-block img-fluid" src="./long-wide-table-example.jpg"/></p>
<h2>Mas para que serve a função <code>pd.wide_to_long</code>?</h2>
<p>O próximo exemplo é baseado em um exemplo existente na documentação, mas eu inventei um contexto a mais para esses dados.</p>
<p>No mundo real, e pelas mais diferentes razões, os dados podem estar organizados nas mais variadas formas.</p>
<p>Imagine por exemplo, que por alguma razão, os nomes das colunas de uma tabela codificam uma informação importante, e queiramos utilizar essa informação como valores na nossa tabela.</p>
<p>Por exemplo, imagine a seguinte tabela com informações sobre a quantidade de vendas de dois produtos ‘A’ e ‘B’, durante cinco semanas dos anos de 2020 e 2021.</p>
<p>Os dados estão organizados na tabela com as seguintes colunas:</p>
<div class="highlight"><pre><span></span><code>'A(weekly)-2020', 'A(weekly)-2021', 'B(weekly)-2020', 'B(weekly)-2021', 'week'
</code></pre></div>
<p>As colunas com informações do produto seguem o seguinte padrão: A ou B para identificar o produto seguido da expressão (weekly); um carácter de separação ‘-’; mais o valor que representa o ano (2020 ou 2021).</p>
<p>Os nomes das colunas podem ser divididos em duas partes que, para seguir a nomeação dada pela documentação, chamaremos de prefixo e sufixo.</p>
<p>Os prefixos seriam as expressões ‘A(weekly)’ e ‘B(weekly)’ que codificam a informação do tipo do produto.</p>
<p>Já os sufixos seriam os valores para os anos: 2020 e 2021.</p>
<p>Então, antes de seguir a leitura, note que identificamos nos nomes das colunas:</p>
<ul>
<li>Um prefixo: ‘A(weekly)’ e ‘B(weekly)’</li>
<li>Um carácter de separação: ‘-’</li>
<li>Um sufixo: os valores</li>
</ul>
<h2>Parâmetros da função</h2>
<p>De acordo com a documentação, a função <code>pd.wide_to_long</code> possui os seguintes parâmetros:</p>
<ul>
<li>df é o dataframe a ser transformado.</li>
<li>stubnames (str ou uma lista) indica os valores dos prefixos presentes nos nomes das colunas, que serão utilizados para transformar o dataframe. Uma definição da palavra <em>stub</em> pode ser encontrada no <a href="https://dictionary.cambridge.org/dictionary/english/stub">dicionário Cambridge</a>;</li>
<li>i (str ou uma lista) indica as colunas que serão utilizadas com identificadores (id) das observações, essas colunas serão transformadas em índices do dataframe retornado.</li>
<li>j (str) : indica o nome da coluna que será criada com os valores identificados pelos sufixos</li>
<li>sep : indica o caractere de separação entre os prefixos e os sufixos dos nomes das colunas.</li>
<li>suffix: aceita uma expressão regular que será utilizada para a identificação dos sufixos;</li>
<li>O valor padrão é <code>\d+</code> que captura valores numéricos.</li>
<li>Esse parâmetro pode ser alterado para <code>\w+</code> que captura strings</li>
</ul>
<p>Particularmente, eu tenho a impressão que a biblioteca pandas poderia ser muito mais consistente na escolha dos nomes dos parâmetros. Porém, eu entendo que o desenvolvimento de qualquer software é uma atividade dinâmica que envolve diversas pessoas, durante um longo período de tempo, e ter essa consistência não é uma tarefa simples.</p>
<p>De qualquer forma, eu não acho que o nome desses parâmetros (i e j) sejam bons indicadores do que eles são. Repare que o parâmetro i pode receber uma string ou uma lista, mas o parâmetro <code>j</code> só recebe uma string, que é o nome da nova (e única) coluna criada. À primeira vista, isso pareceu meio confuso para mim.</p>
<h2>Exemplos de uso</h2>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="o">&gt;&gt;</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'A(weekly)-2020'</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span>
                   <span class="s1">'A(weekly)-2021'</span><span class="p">:</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">45</span><span class="p">],</span>
                   <span class="s1">'B(weekly)-2020'</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">],</span>
                   <span class="s1">'B(weekly)-2021'</span><span class="p">:</span> <span class="p">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">44</span><span class="p">],</span>
                   <span class="s1">'week'</span> <span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]})</span>

<span class="o">&gt;&gt;</span> <span class="n">df</span>
</code></pre></div>
<div class="table-responsive">
<table border="0" class="table text-center dataframe table-striped table-hover">
<thead class="table-secondary">
<tr>
<th></th>
<th>A(weekly)-2020</th>
<th>A(weekly)-2021</th>
<th>B(weekly)-2020</th>
<th>B(weekly)-2021</th>
<th>week</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>10</td>
<td>11</td>
<td>5</td>
<td>32</td>
<td>1</td>
</tr>
<tr>
<th>1</th>
<td>23</td>
<td>77</td>
<td>44</td>
<td>56</td>
<td>2</td>
</tr>
<tr>
<th>2</th>
<td>59</td>
<td>34</td>
<td>33</td>
<td>43</td>
<td>3</td>
</tr>
<tr>
<th>3</th>
<td>90</td>
<td>8</td>
<td>22</td>
<td>12</td>
<td>4</td>
</tr>
<tr>
<th>4</th>
<td>2</td>
<td>12</td>
<td>1</td>
<td>67</td>
<td>5</td>
</tr>
<tr>
<th>5</th>
<td>8</td>
<td>45</td>
<td>32</td>
<td>44</td>
<td>6</td>
</tr>
</tbody>
</table>
</div>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
<span class="n">Index</span><span class="p">([</span>
  <span class="s1">'A(weekly)-2020'</span><span class="p">,</span>
  <span class="s1">'A(weekly)-2021'</span><span class="p">,</span>
  <span class="s1">'B(weekly)-2020'</span><span class="p">,</span>
  <span class="s1">'B(weekly)-2021'</span><span class="p">,</span>
  <span class="s1">'week'</span><span class="p">],</span>
<span class="n">dtype</span><span class="o">=</span><span class="s1">'object'</span><span class="p">)</span>

<span class="c1"># Neste caso não seria necessário passar o valor do parâmetro `suffix` já que por padrão ele é '\d+'</span>

<span class="n">pd</span><span class="o">.</span><span class="n">wide_to_long</span><span class="p">(</span><span class="n">df</span><span class="p">,</span>
                <span class="n">stubnames</span><span class="o">=</span><span class="p">[</span><span class="s1">'A(weekly)'</span><span class="p">,</span> <span class="s1">'B(weekly)'</span><span class="p">],</span>
                <span class="n">i</span><span class="o">=</span><span class="s1">'week'</span><span class="p">,</span>
                <span class="n">j</span><span class="o">=</span><span class="s1">'year'</span><span class="p">,</span>
                <span class="n">sep</span><span class="o">=</span><span class="s1">'-'</span><span class="p">,</span>
                <span class="n">suffix</span><span class="o">=</span><span class="s1">'\d+'</span>
              <span class="p">)</span>
</code></pre></div>
<div class="table-responsive">
<table border="0" class="table text-center dataframe table-striped table-hover">
<thead class="table-secondary">
<tr>
<th></th>
<th></th>
<th>A(weekly)</th>
<th>B(weekly)</th>
</tr>
<tr>
<th>week</th>
<th>year</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<th>1</th>
<th>2020</th>
<td>10</td>
<td>5</td>
</tr>
<tr>
<th>2</th>
<th>2020</th>
<td>23</td>
<td>44</td>
</tr>
<tr>
<th>3</th>
<th>2020</th>
<td>59</td>
<td>33</td>
</tr>
<tr>
<th>4</th>
<th>2020</th>
<td>90</td>
<td>22</td>
</tr>
<tr>
<th>5</th>
<th>2020</th>
<td>2</td>
<td>1</td>
</tr>
<tr>
<th>6</th>
<th>2020</th>
<td>8</td>
<td>32</td>
</tr>
<tr>
<th>1</th>
<th>2021</th>
<td>11</td>
<td>32</td>
</tr>
<tr>
<th>2</th>
<th>2021</th>
<td>77</td>
<td>56</td>
</tr>
<tr>
<th>3</th>
<th>2021</th>
<td>34</td>
<td>43</td>
</tr>
<tr>
<th>4</th>
<th>2021</th>
<td>8</td>
<td>12</td>
</tr>
<tr>
<th>5</th>
<th>2021</th>
<td>12</td>
<td>67</td>
</tr>
<tr>
<th>6</th>
<th>2021</th>
<td>45</td>
<td>44</td>
</tr>
</tbody>
</table>
</div>
<p>Para transformar essa tabela do formato longo para o amplo (wide), podemos utilizar o método <code>.unstack</code>, como mostra o exemplo a seguir.</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;</span> <span class="n">df2</span> <span class="o">=</span> <span class="n">_</span> <span class="c1"># captura a resposta da célula anterior</span>
<span class="o">&gt;&gt;</span> <span class="n">df2</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
</code></pre></div>
<div class="table-responsive">
<table border="0" class="table text-center dataframe table-striped table-hover">
<thead class="table-secondary">
<tr>
<th></th>
<th colspan="2" halign="left">A(weekly)</th>
<th colspan="2" halign="left">B(weekly)</th>
</tr>
<tr>
<th>year</th>
<th>2020</th>
<th>2021</th>
<th>2020</th>
<th>2021</th>
</tr>
<tr>
<th>week</th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<th>1</th>
<td>10</td>
<td>11</td>
<td>5</td>
<td>32</td>
</tr>
<tr>
<th>2</th>
<td>23</td>
<td>77</td>
<td>44</td>
<td>56</td>
</tr>
<tr>
<th>3</th>
<td>59</td>
<td>34</td>
<td>33</td>
<td>43</td>
</tr>
<tr>
<th>4</th>
<td>90</td>
<td>8</td>
<td>22</td>
<td>12</td>
</tr>
<tr>
<th>5</th>
<td>2</td>
<td>12</td>
<td>1</td>
<td>67</td>
</tr>
<tr>
<th>6</th>
<td>8</td>
<td>45</td>
<td>32</td>
<td>44</td>
</tr>
</tbody>
</table>
</div>
<h2>Um exemplo avançado do uso do parâmetro <code>suffix</code></h2>
<p>A página da documentação menciona rapidamente um caso de uso alternativo para o uso parâmetro <code>suffix</code>. Na verdade, essa menção encontra-se na própria descrição do parâmetro <code>suffix</code>.</p>
<p>Imagine que temos dois produtos ‘A’ e ‘B’ e três canais de anúncio: <span class="caps">TV</span>, internet e rádio. Agora, digamos que estejamos interessados somente nos dados para dois canais de anúncio: <span class="caps">TV</span> e internet.</p>
<p>Podemos utilizar o poder das expressões regulares para transformar os dados referente a esses dois canais de vendas e deixar o terceiro intacto.</p>
<p>Neste caso, basta definir o parâmetro <code>suffix</code> com o seguinte valor <code>suffix=‘(tv|internet)’</code>.</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;</span> <span class="n">df3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'A-tv'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
                   <span class="s1">'A-internet'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
                   <span class="s1">'B-tv'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
                   <span class="s1">'B-internet'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
                   <span class="s1">'B-radio'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
                   <span class="s1">'id'</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                   <span class="p">})</span>
<span class="o">&gt;&gt;</span> <span class="n">df3</span>
</code></pre></div>
<div class="table-responsive">
<table border="0" class="table text-center dataframe table-striped table-hover">
<thead class="table-secondary">
<tr>
<th></th>
<th>A-tv</th>
<th>A-internet</th>
<th>B-tv</th>
<th>B-internet</th>
<th>B-radio</th>
<th>id</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>15</td>
<td>4</td>
<td>57</td>
<td>76</td>
<td>10</td>
<td>0</td>
</tr>
<tr>
<th>1</th>
<td>40</td>
<td>19</td>
<td>78</td>
<td>1</td>
<td>17</td>
<td>1</td>
</tr>
<tr>
<th>2</th>
<td>15</td>
<td>93</td>
<td>67</td>
<td>27</td>
<td>1</td>
<td>2</td>
</tr>
<tr>
<th>3</th>
<td>37</td>
<td>19</td>
<td>21</td>
<td>89</td>
<td>3</td>
<td>3</td>
</tr>
<tr>
<th>4</th>
<td>5</td>
<td>5</td>
<td>78</td>
<td>63</td>
<td>59</td>
<td>4</td>
</tr>
</tbody>
</table>
</div>
<div class="highlight"><pre><span></span><code><span class="n">pd</span><span class="o">.</span><span class="n">wide_to_long</span><span class="p">(</span><span class="n">df3</span><span class="p">,</span>
                <span class="n">stubnames</span><span class="o">=</span><span class="p">[</span><span class="s1">'A'</span><span class="p">,</span> <span class="s1">'B'</span><span class="p">],</span>
                <span class="n">i</span><span class="o">=</span><span class="s1">'id'</span><span class="p">,</span>
                <span class="n">j</span><span class="o">=</span><span class="s1">'type'</span><span class="p">,</span>
                <span class="n">sep</span><span class="o">=</span><span class="s1">'-'</span><span class="p">,</span>
                <span class="n">suffix</span><span class="o">=</span><span class="s1">'(tv|internet)'</span>
              <span class="p">)</span>
</code></pre></div>
<div class="table-responsive">
<table border="0" class="table text-center dataframe table-striped table-hover">
<thead class="table-secondary">
<tr>
<th></th>
<th></th>
<th>B-radio</th>
<th>A</th>
<th>B</th>
</tr>
<tr>
<th>id</th>
<th>type</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<th>tv</th>
<td>10</td>
<td>15</td>
<td>57</td>
</tr>
<tr>
<th>1</th>
<th>tv</th>
<td>17</td>
<td>40</td>
<td>78</td>
</tr>
<tr>
<th>2</th>
<th>tv</th>
<td>1</td>
<td>15</td>
<td>67</td>
</tr>
<tr>
<th>3</th>
<th>tv</th>
<td>3</td>
<td>37</td>
<td>21</td>
</tr>
<tr>
<th>4</th>
<th>tv</th>
<td>59</td>
<td>5</td>
<td>78</td>
</tr>
<tr>
<th>0</th>
<th>internet</th>
<td>10</td>
<td>4</td>
<td>76</td>
</tr>
<tr>
<th>1</th>
<th>internet</th>
<td>17</td>
<td>19</td>
<td>1</td>
</tr>
<tr>
<th>2</th>
<th>internet</th>
<td>1</td>
<td>93</td>
<td>27</td>
</tr>
<tr>
<th>3</th>
<th>internet</th>
<td>3</td>
<td>19</td>
<td>89</td>
</tr>
<tr>
<th>4</th>
<th>internet</th>
<td>59</td>
<td>5</td>
<td>63</td>
</tr>
</tbody>
</table>
</div>
<p>Note que a coluna ‘B-radio’ ainda persiste no resultado final. Se não a desejamos, bastar aplicar o método <code>drop</code> nessa coluna.</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">wide_to_long</span><span class="p">(</span><span class="n">df3</span><span class="p">,</span>
                    <span class="n">stubnames</span><span class="o">=</span><span class="p">[</span><span class="s1">'A'</span><span class="p">,</span> <span class="s1">'B'</span><span class="p">],</span>
                    <span class="n">i</span><span class="o">=</span><span class="s1">'id'</span><span class="p">,</span>
                    <span class="n">j</span><span class="o">=</span><span class="s1">'type'</span><span class="p">,</span>
                    <span class="n">sep</span><span class="o">=</span><span class="s1">'-'</span><span class="p">,</span>
                    <span class="n">suffix</span><span class="o">=</span><span class="s1">'(tv|internet)'</span><span class="p">)</span>
                <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">'B-radio'</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">'columns'</span><span class="p">))</span>
</code></pre></div>
<div class="table-responsive">
<table border="0" class="table text-center dataframe table-striped table-hover">
<thead class="table-secondary">
<tr>
<th></th>
<th></th>
<th>A</th>
<th>B</th>
</tr>
<tr>
<th>id</th>
<th>type</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<th>tv</th>
<td>15</td>
<td>57</td>
</tr>
<tr>
<th>1</th>
<th>tv</th>
<td>40</td>
<td>78</td>
</tr>
<tr>
<th>2</th>
<th>tv</th>
<td>15</td>
<td>67</td>
</tr>
<tr>
<th>3</th>
<th>tv</th>
<td>37</td>
<td>21</td>
</tr>
<tr>
<th>4</th>
<th>tv</th>
<td>5</td>
<td>78</td>
</tr>
<tr>
<th>0</th>
<th>internet</th>
<td>4</td>
<td>76</td>
</tr>
<tr>
<th>1</th>
<th>internet</th>
<td>19</td>
<td>1</td>
</tr>
<tr>
<th>2</th>
<th>internet</th>
<td>93</td>
<td>27</td>
</tr>
<tr>
<th>3</th>
<th>internet</th>
<td>19</td>
<td>89</td>
</tr>
<tr>
<th>4</th>
<th>internet</th>
<td>5</td>
<td>63</td>
</tr>
</tbody>
</table>
</div>
<h2>Dica para definir <code>sutbnames</code> com expressões regulares</h2>
<p>Um outro exemplo rapidamente mencionado na documentação, é utilizar expressões regulares para identificar os prefixos de forma programática.</p>
<p>Por exemplo, voltemos ao dataframe do primeiro exemplo.</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;</span> <span class="n">df</span>
</code></pre></div>
<div class="table-responsive">
<table border="1" class="table text-center dataframe table-striped table-hover">
<thead class="table-secondary">
<tr>
<th></th>
<th>A(weekly)-2020</th>
<th>A(weekly)-2021</th>
<th>B(weekly)-2020</th>
<th>B(weekly)-2021</th>
<th>week</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>10</td>
<td>11</td>
<td>5</td>
<td>32</td>
<td>1</td>
</tr>
<tr>
<th>1</th>
<td>23</td>
<td>77</td>
<td>44</td>
<td>56</td>
<td>2</td>
</tr>
<tr>
<th>2</th>
<td>59</td>
<td>34</td>
<td>33</td>
<td>43</td>
<td>3</td>
</tr>
<tr>
<th>3</th>
<td>90</td>
<td>8</td>
<td>22</td>
<td>12</td>
<td>4</td>
</tr>
<tr>
<th>4</th>
<td>2</td>
<td>12</td>
<td>1</td>
<td>67</td>
<td>5</td>
</tr>
<tr>
<th>5</th>
<td>8</td>
<td>45</td>
<td>32</td>
<td>44</td>
<td>6</td>
</tr>
</tbody>
</table>
</div>
<p>Poderíamos encontrar os valores dos prefixos utilizando o seguinte código:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;</span> <span class="n">stubnames</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
              <span class="nb">set</span><span class="p">(</span>
                  <span class="p">[</span> <span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">'[A-B]\(.*\)'</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
                    <span class="k">if</span> <span class="n">match</span> <span class="o">!=</span> <span class="p">[]</span> <span class="p">]</span>
                  <span class="p">)</span>
<span class="p">)</span>

<span class="o">&gt;&gt;</span> <span class="n">stubnames</span>
    <span class="p">[</span><span class="s1">'A(weekly)'</span><span class="p">,</span> <span class="s1">'B(weekly)'</span><span class="p">]</span>
</code></pre></div>
<h2>Outras funções para transformação de um dataframe</h2>
<p>A biblioteca pandas também oferece outras funções para alterar a estrutura de um dataframe conforme as nossas necessidades.</p>
<ul>
<li><code>pd.melt</code> - converte um dataframe do formato wide para o formato longo.</li>
<li><code>pd.pivot</code> - pode converter um dataframe do formato longo para wide.</li>
<li><code>dataframe.pivot_table</code> - possui quase a mesma função que a função <code>pd.pivot</code> porém realiza operações de agregação de dados por exemplo, calcular uma média, mediana, realizar uma contagem.</li>
<li><code>dataframe.stack</code> empilha colunas em índices;</li>
<li><code>dataframe.unstack</code> desempilha índices em colunas.</li>
</ul>
<h2>Conclusão</h2>
<p>Neste rápido tutorial, vimos o uso da função <code>pd.wide_to_long</code>.</p>
<p>Eu pessoalmente não conhecia essa função até bem pouco tempo atrás. Talvez porque o problema que essa função se propõe a resolver seja bem específico.</p>
    </section>
  </article>
</div>
    </main>
<div class="container-fluid site-footer">
  <div class="container p-5">
    <footer class="d-flex flex-wrap justify-content-between align-items-center py-3 my-4 border-top">
      <div class="col-md-4 d-flex align-items-center">
        <a href="/" class="mb-3 me-2 mb-md-0 text-body-secondary text-decoration-none lh-1">
          <img src="/images/logo.png" alt="Avatar Logo" style="width:40px;">
        </a>
        <span class="mb-3 mb-md-0 text-body-secondary">Giliard Godoi | 2025 </span>
      </div>

      <ul class="nav col-md-4 justify-content-end list-unstyled d-flex fs-4">
          <li class="ms-3">
            <a class="fab fa-twitter text-decoration-none link-secondary" href="https://twitter.com/giliardgodoi" target="_blank" width="24" height="24"></a>
          </li>
          <li class="ms-3">
            <a class="fab fa-github text-decoration-none link-secondary" href="https://github.com/GiliardGodoi" target="_blank" width="24" height="24"></a>
          </li>
          <li class="ms-3">
            <a class="fab fa-linkedin-in text-decoration-none link-secondary" href="https://www.linkedin.com/in/giliardgodoi/" target="_blank" width="24" height="24"></a>
          </li>
          <li class="ms-3">
            <a class="fab fa-youtube text-decoration-none link-secondary" href="https://www.youtube.com/user/GiliardGodoi" target="_blank" width="24" height="24"></a>
          </li>
        <!-- <li class="ms-3"><a class="text-body-secondary" href="#"><svg class="bi" width="24" height="24"><use xlink:href="#twitter"></use></svg></a></li>
        <li class="ms-3"><a class="text-body-secondary" href="#"><svg class="bi" width="24" height="24"><use xlink:href="#instagram"></use></svg></a></li>
        <li class="ms-3"><a class="text-body-secondary" href="#"><svg class="bi" width="24" height="24"><use xlink:href="#facebook"></use></svg></a></li> -->
      </ul>
    </footer>
  </div>
  </div>  </body>
<script src="https://giliardgodoi.github.io/theme/js/bootstrap/bootstrap.min.js"></script>
</html>